{"version":3,"sources":["../src/routes.js"],"names":["api","express","Router","get","UserController","LoadConfig","auth","McqController","GetAll","GetMcqsBySkill","post","Add","put","Update","delete","Delete","BulkDelete","BulkMcq","CategoryController","SkillController","GradeController","OrgController","RmaRequestController","AdminTestController","GetMy","GetMcqsByTestId","GetCandidatesByTestId","GetTest","AddNewUserToBeVerified","VerifyUser","storage","multer","diskStorage","destination","req","file","cb","console","log","files","uploadDir","path","resolve","Constants","Paths","recordingBaseDir","fieldname","fs","existsSync","mkdirSync","filename","originalname","upload","any","MediaController","SubmitRecording","GetRecordingFileNames","GetRecording","CandidateResponseController","GetCandidateResponse","GetCandidateDetails","TestInviteController","GetInvitation","SendInvite","StartTest","SubmitAnswers","EvaluateAnswers","DashboardController","GetTestCount","GetMcqCount","GetInvitationCount","passport","authenticate","session","scope","res","next","user","status","send","generateToken","sendToken","AuthenticateCandidate","failureRedirect","redirect"],"mappings":"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","file":"routes.js","sourcesContent":["import express  from 'express';\r\nimport { McqController, CategoryController, SkillController,\r\n        CandidateController, AdminTestController, InviteController,\r\n        UserController, GradeController } from './Controllers/admin';\r\nimport { TestInviteController } from './Controllers/candidate';\r\n\r\nimport { RmaRequestController } from './Controllers/hitech';\r\n\r\nimport { generateToken, sendToken } from './utils/token.utils';\r\nimport passport from 'passport';\r\nimport auth from './utils/auth';\r\nimport OrgController from './Controllers/admin/OrgController';\r\nimport DashboardController from './Controllers/admin/DashboardController';\r\nimport CandidateResponseController from './Controllers/admin/CandidateResponseController';\r\nimport MediaController from './Controllers/candidate/MediaController';\r\nimport multer from 'multer';\r\n\r\nimport fs from 'fs';\r\nimport path from 'path';\r\nimport Constants from './commons/Constants';\r\n\r\nlet api = express.Router();\r\n\r\n\r\napi.get('/loadConfig', UserController.LoadConfig);\r\napi.get('/validateUserToken', auth, UserController.LoadConfig);\r\n\r\n/* Admin Routes */\r\n/* mcq endpoints */\r\n// api.get('/admin/getAllMcqs', McqController.GetAll);\r\napi.get('/admin/getAllMcqs', auth, McqController.GetAll);\r\napi.get('/admin/getMcqsBySkill', auth, McqController.GetMcqsBySkill);\r\napi.post('/admin/mcq', auth, McqController.Add);\r\napi.put('/admin/mcq', auth, McqController.Update);\r\napi.delete('/admin/mcq', auth, McqController.Delete);\r\napi.delete('/admin/bulkmcq', McqController.BulkDelete);\r\napi.post('/admin/bulkMcq', auth, McqController.BulkMcq);\r\n\r\n/* category endpoints */\r\napi.get('/admin/getAllCategories', auth, CategoryController.GetAll);\r\napi.post('/admin/category', auth, CategoryController.Add);\r\napi.put('/admin/category', auth, CategoryController.Update);\r\napi.delete('/admin/category', auth, CategoryController.Delete);\r\n\r\n/* skill endpoints */\r\napi.get('/admin/getAllSkills', auth, SkillController.GetAll);\r\napi.post('/admin/skill', auth, SkillController.Add);\r\napi.delete('/admin/skill', auth, SkillController.Delete);\r\n\r\n/* class/grade endpoints */\r\napi.get('/admin/getAllGrades', auth, GradeController.GetAll);\r\napi.post('/admin/grade', auth, GradeController.Add);\r\napi.put('/admin/grade', auth, GradeController.Update);\r\napi.delete('/admin/grade', auth, GradeController.Delete);\r\n\r\n/* org endpoints */\r\napi.get('/admin/getAllOrgs', auth, OrgController.GetAll);\r\napi.post('/admin/org', auth, OrgController.Add);\r\napi.put('/admin/org', auth, OrgController.Update);\r\napi.delete('/admin/org', auth, OrgController.Delete);\r\n\r\n/* hitech endpoints */\r\napi.get('/hitech/rmaRequests', RmaRequestController.GetAll);\r\napi.post('/hitech/rmaRequest', RmaRequestController.Add);\r\napi.get('/hitech/deleteRmaRequest', RmaRequestController.Delete);\r\n\r\n/* Admin Test endpoints */\r\napi.get('/admin/getAllTests', auth, AdminTestController.GetAll);\r\napi.get('/admin/getMyTests', auth, AdminTestController.GetMy);\r\napi.get('/admin/getMcqsByTestId', auth, AdminTestController.GetMcqsByTestId);\r\napi.get('/admin/getCandidatesByTestId', auth, AdminTestController.GetCandidatesByTestId);\r\napi.get('/admin/getTest', auth, AdminTestController.GetTest);\r\napi.post('/admin/test', auth, AdminTestController.Add);\r\napi.put('/admin/test', auth, AdminTestController.Update);\r\napi.delete('/admin/test', auth, AdminTestController.Delete);\r\n\r\n/* User endpoints */\r\napi.get('/admin/getAllUsers', auth,  UserController.GetAll);\r\napi.post('/admin/user', auth, UserController.Add);\r\napi.put('/admin/user', auth, UserController.Update);\r\napi.delete('/admin/user', auth, UserController.Delete);\r\n\r\n\r\n/* Online portal endpoints */\r\napi.post('/candidate/user', UserController.AddNewUserToBeVerified);\r\napi.get('/candidate/verifyUser', UserController.VerifyUser);\r\n//let upload = multer({ dest: 'uploads/responseRecordiings' })\r\nvar storage = multer.diskStorage({\r\n    destination: function (req, file, cb) {\r\n        console.log('s1', req.files);\r\n        console.log('s2', file);\r\n        // let uploadDir = path.resolve(`uploads/responseRecordiings/${file.fieldname}`);\r\n        let uploadDir = path.resolve(`${Constants.Paths.recordingBaseDir}\\\\${file.fieldname}`);\r\n        console.log('uploaddir', uploadDir);\r\n        if(!fs.existsSync(uploadDir)) {\r\n            fs.mkdirSync(uploadDir);\r\n        }\r\n        cb(null, uploadDir);\r\n    },\r\n    filename: function (req, file, cb) {\r\n        console.log('filename', file);\r\n      //const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9)\r\n      cb(null, file.fieldname + '_' + file.originalname)\r\n    }\r\n  })\r\n  \r\nlet upload = multer({ storage: storage })\r\napi.post('/candidate/submitRecording', upload.any(), MediaController.SubmitRecording);\r\napi.get('/candidate/getRecordingFileNames', MediaController.GetRecordingFileNames);\r\napi.get('/candidate/getRecording', MediaController.GetRecording);\r\n\r\napi.post('/teacher/user', UserController.AddNewUserToBeVerified)\r\napi.get('/teacher/verifyUser', UserController.VerifyUser);\r\n// api.get('/teacher/pubslisAndSendInvites', AdminTestController.PubslisAndSendInvites);\r\n\r\n/* Candidate Response Endpoints */\r\napi.get('/admin/getCandidateResponseReport', auth, CandidateResponseController.GetCandidateResponse);\r\napi.get('/admin/getCandidateDetails', auth, CandidateResponseController.GetCandidateDetails);\r\n\r\n/* Candidate Routes */\r\n/* Test Invite endpoints */\r\napi.get('/candidate/getAllInvites', auth, TestInviteController.GetAll);\r\napi.get('/candidate/invitation', TestInviteController.GetInvitation);\r\napi.post('/candidate/sendInvite', auth, TestInviteController.SendInvite);\r\napi.post('/candidate/startTest', auth, TestInviteController.StartTest);\r\napi.post('/candidate/submitAnswers', auth, TestInviteController.SubmitAnswers);\r\napi.post('/candidate/evaluateAnswers', auth, TestInviteController.EvaluateAnswers);\r\n\r\napi.get('/admin/dashboard/test/count', auth, DashboardController.GetTestCount);\r\napi.get('/admin/dashboard/mcq/count', auth, DashboardController.GetMcqCount);\r\napi.get('/admin/dashboard/invitation/count', auth, DashboardController.GetInvitationCount);\r\n// api.get('/admin/dashboard', auth, DashboardController.GetAllStatistics);\r\n\r\napi.get('/admin/auth/google',\r\n    passport.authenticate('google-token', { session: false, scope: ['https://www.googleapis.com/auth/plus.login'] }),\r\n    (req, res, next) => {\r\n        console.log('res next');\r\n        req.auth = req.user;\r\n        if(req.user.status === 'not found') {\r\n            return res.status(403).send('User Not Found');\r\n        }\r\n        next();\r\n    }, generateToken, sendToken);\r\n\r\n    \r\napi.post('/admin/auth/local',passport.authenticate('local',{session: false}),\r\n   (req, res, next) => {\r\n    console.log('received local call');\r\n    req.auth = req.user;\r\n        if(req.user.status === 'not found') {\r\n            return res.status(401).send('User Not Found');\r\n        }\r\n        next();\r\n}, generateToken, sendToken);\r\n\r\n\r\napi.post('/candidate/auth/local',TestInviteController.AuthenticateCandidate,\r\n   (req, res, next) => {\r\n       console.log('returned from authenticate candidate', req.user);\r\n        req.auth = req.user;\r\n        if(req.user.status === 'not found') {\r\n            return res.status(401).send('Candidate Not Registered');\r\n        }\r\n        next();\r\n}, generateToken, sendToken);\r\n\r\n// GET /auth/google/callback\r\n//   Use passport.authenticate() as route middleware to authenticate the\r\n//   request.  If authentication fails, the user will be redirected back to the\r\n//   login page.  Otherwise, the primary route function function will be called,\r\n//   which, in this example, will redirect the user to the home page.\r\napi.get('/admin/auth/google/callback', \r\n  passport.authenticate('google-token', { failureRedirect: '/login' }),\r\n  function(req, res) {\r\n      console.log('res 3');\r\n    res.redirect('/');\r\n  });\r\n\r\n/*\r\napi.route('/admin/auth/callback', (req, resp) => {\r\n    console.log('admin api callback called');\r\n})\r\napi.get('/admin/auth/google',\r\n        passport.authenticate('google-token'), \r\n        (req, res, next) => {\r\n            console.log('res returned');\r\n            if (!req.user) {\r\n                return res.send(401, 'User Not Authenticated');\r\n            }\r\n            req.auth = {\r\n                id: req.user.id\r\n            };\r\n            next();\r\n        }, \r\n        generateToken, \r\n        sendToken);*/\r\nexport default api;\r\n"]}