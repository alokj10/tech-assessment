{"version":3,"sources":["../../src/commons/EmailHelper.js"],"names":["fs","require","EmailHelper","CreateTransporter","transporter","nodemailer","createTransport","host","EmailConfig","emailSmtpHost","port","emailSmtpPort","secure","requireTLS","auth","user","emailAuthUser","pass","emailAuthPassword","SendEmailWithAttachment","emailInfo","mailOptions","from","inviteFromEmailId","to","subject","text","attachments","path","attachmentPath","sendMail","error","info","console","log","messageId","response","SendEmail","Promise","resolve","reject","bcc","enevelope","html","CreateHtml","LogEmail","GetHtmlTemplateByType","notificationType","replace","testName","testLink","testDuration","faqLink","rmaRequest","customerDetails","customerName","telephone","contactPerson","rmaLink","user_name","verification_link","invokeReplaceFunction","fileName","filePath","contentToLog","appendFileSync","file","__dirname","readFileSync","encoding"],"mappings":"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","file":"EmailHelper.js","sourcesContent":["import nodemailer from 'nodemailer';\r\nimport { EmailConfig, DbConfig } from './ServerConfig';\r\nvar fs = require('fs');\r\nimport path from 'path';\r\n\r\nclass EmailHelper {\r\n\r\n    CreateTransporter = () => {\r\n        let transporter = nodemailer.createTransport({\r\n            host: EmailConfig.emailSmtpHost,\r\n            port: EmailConfig.emailSmtpPort,\r\n            secure: false,\r\n            requireTLS: true,\r\n            auth: {\r\n                user: EmailConfig.emailAuthUser,\r\n                pass: EmailConfig.emailAuthPassword\r\n            }\r\n        });\r\n        return transporter;\r\n    }\r\n\r\n    SendEmailWithAttachment = (emailInfo) => {\r\n        let transporter = this.CreateTransporter();\r\n        let mailOptions = {\r\n            from: EmailConfig.inviteFromEmailId,\r\n            to: emailInfo.to,\r\n            subject: emailInfo.subject,\r\n            text: emailInfo.text,\r\n            attachments: [\r\n                {\r\n                    path: emailInfo.attachmentPath\r\n                }\r\n            ]\r\n        }\r\n        transporter.sendMail(mailOptions, (error, info) => {\r\n            if(error) {\r\n                console.log('error occured in sending email');\r\n                console.log(error);\r\n                return;\r\n            }\r\n            console.log('email sent: ' + info.messageId + ', resp: ' + info.response);\r\n        })\r\n    }\r\n\r\n    SendEmail = (emailInfo) => {\r\n        console.log('email helper send called');\r\n        return new Promise((resolve, reject) => {\r\n\r\n            let transporter = this.CreateTransporter();\r\n            let mailOptions = {\r\n                from: EmailConfig.inviteFromEmailId,\r\n                to: emailInfo.to,\r\n                bcc: EmailConfig.inviteFromEmailId,\r\n                enevelope: {\r\n                    from: EmailConfig.inviteFromEmailId,\r\n                    to: emailInfo.to\r\n                },\r\n                subject: emailInfo.subject,\r\n                // text: emailInfo.text,\r\n                html: this.CreateHtml(emailInfo)\r\n            }\r\n    \r\n            transporter.sendMail(mailOptions, (error, info) => {\r\n                if(error) {\r\n                    console.log('error occured in sending email');\r\n                    console.log(error);\r\n                    reject(error);\r\n                }\r\n                else {\r\n                    resolve();\r\n                    console.log('email sent: ' + info.messageId + ', resp: ' + info.response);\r\n                }\r\n            })\r\n            \r\n            this.LogEmail(mailOptions);\r\n        })\r\n    }\r\n\r\n    CreateHtml = (emailInfo) => {\r\n        let html = this.GetHtmlTemplateByType(emailInfo);\r\n        if(emailInfo.notificationType === 'test') {\r\n            html = html.replace('$$test_name$$', emailInfo.testName);\r\n            html = html.replace('$$test_title$$', emailInfo.testName);\r\n            html = html.replace('$$test_link$$', emailInfo.testLink);\r\n            html = html.replace('$$test_duration$$', emailInfo.testDuration);\r\n            html = html.replace('$$faq_link$$', emailInfo.faqLink);\r\n        }\r\n        if(emailInfo.notificationType === 'rma') {\r\n            if(emailInfo.rmaRequest.customerDetails) {\r\n                html = html.replace('$$customer_name$$', emailInfo.rmaRequest.customerDetails.customerName);\r\n                html = html.replace('$$telephone$$', emailInfo.rmaRequest.customerDetails.telephone);\r\n                html = html.replace('$$contact_person$$', emailInfo.rmaRequest.customerDetails.contactPerson);\r\n                html = html.replace('$$rma_link$$', emailInfo.rmaLink);\r\n            }\r\n        }\r\n        if(emailInfo.notificationType === 'verify_user_email') {\r\n            html = html.replace('$$user_name$$', emailInfo.user_name);\r\n            html = html.replace('$$verification_link$$', emailInfo.verification_link);\r\n        }\r\n        if(emailInfo.notificationType === 'test_result_email') {\r\n            html = emailInfo.invokeReplaceFunction(html);\r\n        }\r\n        return html;\r\n    }\r\n\r\n    LogEmail = (mailOptions) => {\r\n        let fileName = 'EmailLogs.html';\r\n        let filePath = path.resolve(fileName);\r\n        console.log(`Log file path: ${filePath}`);\r\n        let contentToLog = '';\r\n        contentToLog += `From: ${mailOptions.from}\\\\n`;\r\n        contentToLog += `To: ${mailOptions.to}\\\\n`;\r\n        contentToLog += `Subject: ${mailOptions.subject}\\\\n`;\r\n        contentToLog += `\\n\\n${mailOptions.html}`;\r\n        contentToLog += `\\n\\n------------------End of message-------------------\\n\\n`;\r\n        fs.appendFileSync(filePath, contentToLog);\r\n\r\n    }\r\n\r\n    GetHtmlTemplateByType = (emailInfo) => {\r\n        let html = '';\r\n\r\n        switch(emailInfo.notificationType)\r\n        {\r\n            case 'test':\r\n            {\r\n                let file = path.resolve(__dirname + '/testinvitationTemplate.html');\r\n                console.log('template path', file); \r\n                html = fs.readFileSync(file, {encoding: 'utf8'});\r\n                break;\r\n            }\r\n            case 'rma':\r\n            {\r\n                let file = path.resolve(__dirname + '/rmatemplate.html');\r\n                console.log('template path', file); \r\n                html = fs.readFileSync(file, {encoding: 'utf8'});\r\n                break;\r\n            }\r\n            case 'verify_user_email':\r\n            {\r\n                let file = path.resolve(__dirname + '/EmailTemplates/VerifyUserTemplate.html');\r\n                console.log('template path', file); \r\n                html = fs.readFileSync(file, {encoding: 'utf8'});\r\n                break;\r\n            }\r\n            case 'test_result_email':\r\n            {\r\n                let file = path.resolve(__dirname + '/EmailTemplates/TestResultTemplate.html');\r\n                console.log('template path', file); \r\n                html = fs.readFileSync(file, {encoding: 'utf8'});\r\n                break;\r\n            }\r\n        }\r\n        return html;\r\n    }\r\n}\r\nexport default EmailHelper;\r\n\r\n/*const htmlTemplate = `\r\n<style>\r\n.MuiTypography-subtitle1-87 {\r\n    color: rgba(0, 0, 0, 0.87);\r\n    font-size: 1rem;\r\n    font-family: \"Roboto\", \"Helvetica\", \"Arial\", sans-serif;\r\n    font-weight: 400;\r\n    line-height: 1.75;\r\n    letter-spacing: 0.00938em;\r\n}\r\n.MuiTypography-alignCenter-92 {\r\n    text-align: center;\r\n}\r\n.MuiTypography-root-69 {\r\n    margin: 0;\r\n    display: block;\r\n}\r\n.MuiTypography-button-80 {\r\n    color: rgba(0, 0, 0, 0.87);\r\n    font-size: 0.875rem;\r\n    font-weight: 500;\r\n    font-family: \"Roboto\", \"Helvetica\", \"Arial\", sans-serif;\r\n    text-transform: uppercase;\r\n}\r\n.MuiDivider-root-117 {\r\n    height: 1px;\r\n    margin: 0;\r\n    border: none;\r\n    flex-shrink: 0;\r\n    background-color: rgba(0, 0, 0, 0.12);\r\n}\r\n.MuiButton-sizeLarge-1131 {\r\n    padding: 8px 24px;\r\n    font-size: 0.9375rem;\r\n}\r\n.MuiButton-contained-1118 {\r\n    color: rgba(0, 0, 0, 0.87);\r\n    box-shadow: 0px 1px 5px 0px rgba(0,0,0,0.2), 0px 2px 2px 0px rgba(0,0,0,0.14), 0px 3px 1px -2px rgba(0,0,0,0.12);\r\n    background-color: #e0e0e0;\r\n}\r\n.MuiButton-root-1107 {\r\n    color: rgba(0, 0, 0, 0.87);\r\n    padding: 6px 16px;\r\n    font-size: 0.875rem;\r\n    min-width: 64px;\r\n    box-sizing: border-box;\r\n    transition: background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;\r\n    line-height: 1.75;\r\n    font-weight: 500;\r\n    font-family: \"Roboto\", \"Helvetica\", \"Arial\", sans-serif;\r\n    border-radius: 4px;\r\n    text-transform: uppercase;\r\n}\r\n.MuiButtonBase-root-57 {\r\n    color: inherit;\r\n    border: 0;\r\n    margin: 0;\r\n    cursor: pointer;\r\n    display: inline-flex;\r\n    outline: none;\r\n    padding: 0;\r\n    position: relative;\r\n    align-items: center;\r\n    user-select: none;\r\n    border-radius: 0;\r\n    vertical-align: middle;\r\n    justify-content: center;\r\n    -moz-appearance: none;\r\n    text-decoration: none;\r\n    background-color: transparent;\r\n    -webkit-appearance: none;\r\n    -webkit-tap-highlight-color: transparent;\r\n}\r\n.MuiButton-label-1108 {\r\n    width: 100%;\r\n    display: inherit;\r\n    align-items: inherit;\r\n    justify-content: inherit;\r\n}\r\n.MuiTouchRipple-root-259 {\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    display: block;\r\n    z-index: 0;\r\n    position: absolute;\r\n    overflow: hidden;\r\n    border-radius: inherit;\r\n    pointer-events: none;\r\n}\r\n.MuiButton-containedSecondary-1120 {\r\n    color: #fff;\r\n    background-color: #f50057;\r\n    border-radius: 4px;\r\n    padding: 1%;\r\n}\r\na {\r\n    text-decoration: none;\r\n}\r\nbutton {\r\n    align-items: flex-start;\r\n    text-align: center;\r\n    cursor: default;\r\n    color: buttontext;\r\n    background-color: buttonface;\r\n    box-sizing: border-box;\r\n    padding: 2px 6px 3px;\r\n    border-width: 2px;\r\n    border-style: outset;\r\n    border-color: buttonface;\r\n    border-image: initial;\r\n}\r\nbutton {\r\n    -webkit-writing-mode: horizontal-tb !important;\r\n}\r\n.MuiDivider-root-117 {\r\n    height: 1px;\r\n    margin: 0;\r\n    border: none;\r\n    flex-shrink: 0;\r\n    background-color: rgba(0, 0, 0, 0.12);\r\n}\r\nhr {\r\n    display: block;\r\n    unicode-bidi: isolate;\r\n    margin-block-start: 0.5em;\r\n    margin-block-end: 0.5em;\r\n    margin-inline-start: auto;\r\n    margin-inline-end: auto;\r\n    overflow: hidden;\r\n    border-style: inset;\r\n    border-width: 1px;\r\n}\r\n.MuiTypography-gutterBottom-96 {\r\n    margin-bottom: 0.35em;\r\n}\r\n.MuiTypography-alignCenter-92 {\r\n    text-align: center;\r\n}\r\n.MuiTypography-subtitle2-88 {\r\n    color: rgba(0, 0, 0, 0.87);\r\n    font-size: 0.875rem;\r\n    font-family: \"Roboto\", \"Helvetica\", \"Arial\", sans-serif;\r\n    font-weight: 500;\r\n    line-height: 1.57;\r\n    letter-spacing: 0.00714em;\r\n}\r\n.MuiTypography-headline-74 {\r\n    color: rgba(0, 0, 0, 0.87);\r\n    font-size: 1.9rem;\r\n    font-weight: 600;\r\n    font-family: \"Roboto\", \"Helvetica\", \"Arial\", sans-serif;\r\n    line-height: 1.65417em;\r\n    text-align: center;\r\n    padding: 2%;\r\n}\r\n</style>\r\n<body>\r\n<span class=\"MuiTypography-root-69 MuiTypography-headline-74 MuiCardHeader-title-1042\">$$test_name$$</span>\r\n<h3 class=\"MuiTypography-root-69 MuiTypography-subtitle1-87 MuiTypography-alignCenter-92\">\r\nYou have been invited to attend the Junior C# developer challenge. We wish you all the best!\r\n</h3>\r\n<div style=\"margin-top: 2%;\">\r\n<span class=\"MuiTypography-root-69 MuiTypography-button-80 MuiTypography-alignCenter-92\">\r\nDuration: 90 mins\r\n<br><br>\r\n<a href=\"$$test_link$$\" style=\"margin-top: 2%;\">\r\n<button class=\"MuiButtonBase-root-57 MuiButton-root-1107 MuiButton-contained-1118 MuiButton-containedSecondary-1120 MuiButton-raised-1121 MuiButton-raisedSecondary-1123 MuiButton-sizeLarge-1131\" tabindex=\"0\" type=\"button\" align=\"center\">\r\n<span class=\"MuiButton-label-1108\">\r\nStart Challenge\r\n</span>\r\n<span class=\"MuiTouchRipple-root-259\"></span>\r\n</button>\r\n</a>\r\n</span>\r\n</div>\r\n<hr class=\"MuiDivider-root-117\" style=\"margin-top: 2%;\">\r\n<h6 class=\"MuiTypography-root-69 MuiTypography-subtitle2-88 MuiTypography-gutterBottom-96 MuiTypography-alignCenter-92\" style=\"margin-top: 2%;\">\r\nFor any technical queries, please refer to <a href=\"#\">FAQ</a> or email us at support@techassessment.com\r\n</h6>\r\n</body>\r\n`;\r\n*/"]}