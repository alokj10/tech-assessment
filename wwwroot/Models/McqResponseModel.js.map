{"version":3,"sources":["../../src/Models/McqResponseModel.js"],"names":["McqResponseModel","entityName","entities","GetAll","userEntity","console","log","Promise","resolve","reject","initializeCollection","then","res","role","users","UserRoles","admin","data","length","GetInvitationsByUser","GetMcqResponse","responseId","db","findOne","catch","err","GetByInvitationId","invitationId","sql","queries","getMcqResponseByInvitationId","executeQuery","serializeToJson","GetMcqResponsesPendingForEvaluation","getMcqResponsesPendingForEvaluation","SerializeToJson","outputArray","field_name","map","item","index","item_value","replace","output","id","JSON","parse","push","Add","entity","insertCustom","insertId","Update","response_meta","modifiedOn","updateCustom","error","promise","getCollection"],"mappings":"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","file":"McqResponseModel.js","sourcesContent":["// import db from './db';\r\nimport db from '../db/mysqldb';\r\nimport users from '../users';\r\nimport queries from '../db/queries';\r\nimport { getCurrentDateTime } from '../commons/HelperFunctions';\r\n\r\nclass McqResponseModel {\r\n    entityName = 'mcqresponses';\r\n    entities = {};\r\n    \r\n    // constructor() {\r\n    //   this.initializeCollection();\r\n    // }\r\n\r\n    GetAll = (userEntity) => {\r\n        console.log('user caller', userEntity);\r\n        return new Promise((resolve, reject) => {\r\n            this.initializeCollection().then((res) => {\r\n                if(userEntity && userEntity.role === users.UserRoles.admin) {\r\n                    console.log(this.entities.data.length);\r\n                    resolve(this.entities.data);\r\n                }\r\n                else {\r\n                    resolve(this.GetInvitationsByUser(userEntity));\r\n                }\r\n            });\r\n        })\r\n    }\r\n\r\n    GetMcqResponse = (responseId) => {\r\n        return new Promise((resolve, reject) => {\r\n            db.findOne(this.entityName, responseId).then((res) => {\r\n                resolve(res);\r\n            }).catch((err) => {\r\n                reject(err);\r\n            })\r\n        })\r\n    }\r\n\r\n    GetByInvitationId = (invitationId) => {\r\n        return new Promise((resolve, reject) => {\r\n            let sql = queries.getMcqResponseByInvitationId(invitationId);\r\n            db.executeQuery(sql).then((res) => {\r\n                let data = db.serializeToJson(res, this.entityName);\r\n                resolve(data[0]);\r\n            }).catch((err) => {\r\n                reject(err);\r\n            })\r\n        })\r\n    }\r\n\r\n    GetMcqResponsesPendingForEvaluation = () => {\r\n        return new Promise((resolve, reject) => {\r\n            let sql = queries.getMcqResponsesPendingForEvaluation();\r\n            db.executeQuery(sql).then((res) => {\r\n                let data = db.serializeToJson(res, this.entityName);\r\n                resolve(data);\r\n            }).catch((err) => {\r\n                reject(err);\r\n            })\r\n        }) \r\n    }\r\n\r\n    SerializeToJson = (data, entityName) => {\r\n        let outputArray = [];\r\n        let field_name = 'response_meta';\r\n        console.log('mcqresp count', data.length);\r\n        if(data && data.length > 0) {\r\n            data.map((item, index) => {\r\n                console.log('item', item);\r\n                let item_value = item[field_name];\r\n                item_value = item_value.replace(/\\n/g, \"\\\\n\");\r\n                item_value = item_value.replace(/\\r/g, \"\\\\r\");\r\n                item_value = item_value.replace(/\\t/g, \"\\\\t\");\r\n                let output = {};\r\n                output.id = item.id;\r\n                output[field_name] = JSON.parse(item_value);\r\n                // output[field_name] = JSON.parse(item[field_name]);\r\n                outputArray.push(output);\r\n            })\r\n        }\r\n        return outputArray;\r\n    }\r\n    \r\n\r\n    Add = (entity) => {\r\n        return new Promise((resolve, reject) => {\r\n            // db.insert(this.entityName, entity).then((insertId) => {\r\n            //     resolve(insertId);\r\n            // });\r\n            db.insertCustom(this.entityName, entity).then((insertId) => {\r\n                resolve(insertId);\r\n            });\r\n        });\r\n    }\r\n\r\n    Update = (entity) => {\r\n        entity.response_meta.modifiedOn = getCurrentDateTime();\r\n        // return new Promise((resolve, reject) => {\r\n        //     db.update(this.entityName, entity.response_meta, entity.id).then((res) => {\r\n        //         resolve(res);\r\n        //     });\r\n        // });\r\n        return new Promise((resolve, reject) => {\r\n            db.updateCustom(this.entityName, entity, entity.id)\r\n                .then((res) => {\r\n                    resolve(res);\r\n                })\r\n                .catch((error) => {\r\n                    reject(error);\r\n                });\r\n        });\r\n    }\r\n\r\n    /*UpdateTestInvite = (testEntity, candidateEmailId, testStatus) => {\r\n        if(testEntity !== null) {\r\n            let candidateInvite = this.GetCandidateInvite(testEntity, candidateEmailId);\r\n            if(candidateInvite !== null) {\r\n                candidateInvite.testStatus = testStatus;\r\n                tests.update(testEntity);\r\n                db.saveDatabase(() => {\r\n                    this.EmailSnapshot('CategoryAdd');\r\n                });\r\n        \r\n                return testEntity;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    GetCandidateInvite = (testEntity, candidateEmailId) => {\r\n        if(testEntity && testEntity.invitations && testEntity.invitations.length > 0) {\r\n            // let filteredCandidates = testEntity.invitations.where((item) => {\r\n            //     return item.emailTo == candidateEmailId;    \r\n            // });\r\n            let filteredCandidates = testEntity.invitations.filter((item) => {\r\n                return item.emailTo === candidateEmailId;\r\n            })\r\n            console.log(`candidates filtered for emailid: ${candidateEmailId}, ${filteredCandidates.length}`);\r\n            if(filteredCandidates && filteredCandidates.length > 0) {\r\n                return filteredCandidates[0];\r\n            }\r\n        }\r\n        return null;\r\n    }*/\r\n\r\n    initializeCollection = () => {\r\n        var promise = new Promise((resolve, reject) => {\r\n            db.getCollection(this.entityName)\r\n                .then((res) => {\r\n                    this.entities = res;\r\n                    resolve(this.entities);\r\n                }).catch((err) => {\r\n                    console.log('error occurred: ', err);\r\n                    reject(err);\r\n                })\r\n        });\r\n        return promise;\r\n    }\r\n}\r\nexport default McqResponseModel;"]}