{"version":3,"sources":["../../src/Models/TestModel.js"],"names":["TestModel","entityName","entities","GetAll","userEntity","queryConfig","VIEW_TESTS","db","GetTest","testId","Promise","resolve","reject","findOne","then","res","serializeToJson","data","console","log","test_meta","output","id","JSON","parse","GetCandidatesByTestId","sql","queries","getCandidatesByTestId","executeQuery","catch","err","Add","entity","status","addedOn","Date","toLocaleDateString","insert","Update","updatedOn","selectedMcqs","length","map","item","index","questionOrderIndex","update","initializeCollection","promise","getCollection"],"mappings":"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","file":"TestModel.js","sourcesContent":["import db from '../db/mysqldb';\r\nimport queries from '../db/queries';\r\n\r\nimport { GetQueryConfig, \r\n    HandlePromise } from '../commons/RoleDefinitions';\r\nimport { VIEW_TESTS } from '../commons/RoleBasedQueries/TestQueries';\r\n\r\nclass TestModel {\r\n    entityName = 'tests';\r\n    entities = {};\r\n    \r\n    GetAll = (userEntity) => {\r\n        let queryConfig = GetQueryConfig(VIEW_TESTS);\r\n        return HandlePromise(db, queryConfig, userEntity);\r\n\r\n        /*return new Promise((resolve, reject) => {\r\n            this.initializeCollection().then((res) => {\r\n                if(userEntity && userEntity.role === users.UserRoles.admin) {\r\n                    console.log(this.entities.data.length);\r\n                    resolve(this.entities.data);\r\n                }\r\n                else {\r\n                    resolve(this.GetTestsByUser(userEntity));\r\n                }\r\n            });\r\n        })*/\r\n    }\r\n\r\n    /*GetTestsByUser = (userEntity) => {\r\n        if(this.entities.data && this.entities.data.length > 0 && userEntity) {\r\n            let filteredTests = this.entities.data.filter((item, index) => {\r\n                return item.test_meta.addedBy = userEntity.emailId;\r\n            });\r\n            console.log(filteredTests.length);\r\n            return filteredTests;\r\n        }\r\n        return [];\r\n    }*/\r\n\r\n    GetTest = (testId) => {\r\n        return new Promise((resolve, reject) => {\r\n            db.findOne(this.entityName, testId)\r\n            .then((res) => {\r\n                resolve(res);\r\n            });\r\n        })\r\n    }\r\n\r\n    serializeToJson = (data) => {\r\n        console.log('test data', data);\r\n        let test_meta = data['test_meta'];\r\n        // test_meta = test_meta.replace(/\\n/g, \"\\\\n\");\r\n        // test_meta = test_meta.replace(/\\r/g, \"\\\\r\");\r\n        // test_meta = test_meta.replace(/\\t/g, \"\\\\t\");\r\n        let output = {};\r\n        output.id = data.id;\r\n        output['test_meta'] = JSON.parse(test_meta);\r\n        return output;\r\n        // output['user_meta'] = JSON.parse(data['user_meta']);\r\n       /* let outputArray = [];\r\n        console.log('data count', data.length);\r\n        if(data && data.length > 0) {\r\n            data.map((item, index) => {\r\n\r\n                let test_meta = item['test_meta'];\r\n                test_meta = test_meta.replace(/\\n/g, \"\\\\n\");\r\n                test_meta = test_meta.replace(/\\r/g, \"\\\\r\");\r\n                test_meta = test_meta.replace(/\\t/g, \"\\\\t\");\r\n                let output = {};\r\n                output.id = item.id;\r\n                output['test_meta'] = JSON.parse(test_meta);\r\n                output['user_meta'] = JSON.parse(item['user_meta']);\r\n                outputArray.push(output);\r\n            })\r\n        }\r\n        return outputArray;*/\r\n    }\r\n\r\n    GetCandidatesByTestId = (testId) => {\r\n        return new Promise((resolve, reject) => {\r\n            let sql = queries.getCandidatesByTestId(testId);\r\n            db.executeQuery(sql).then((res) => {\r\n                resolve(res);\r\n            }).catch((err) => {\r\n                reject(err);\r\n            });\r\n        });\r\n    }\r\n\r\n    Add = (entity) => {\r\n        entity.status = \"DRAFT\";\r\n        entity.addedOn = (new Date()).toLocaleDateString();\r\n        return new Promise((resolve, reject) => {\r\n            db.insert(this.entityName, entity);\r\n            resolve(true);\r\n        });\r\n    }\r\n\r\n    Update = (entity) => {\r\n        entity.test_meta.updatedOn = (new Date()).toLocaleDateString();\r\n        if(entity.test_meta.selectedMcqs && entity.test_meta.selectedMcqs.length > 0) {\r\n            entity.test_meta.selectedMcqs.map((item, index) => {\r\n                item.questionOrderIndex = index;\r\n            })\r\n        }\r\n        return new Promise((resolve, reject) => {\r\n            db.update(this.entityName, entity.test_meta, entity.id).then((res) => {\r\n                resolve(res);\r\n            });\r\n        });\r\n    }\r\n\r\n    initializeCollection = () => {\r\n        var promise = new Promise((resolve, reject) => {\r\n            db.getCollection(this.entityName)\r\n                .then((res) => {\r\n                    this.entities = res;\r\n                    resolve(this.entities);\r\n                }).catch((err) => {\r\n                    console.log('error occurred: ', err);\r\n                    reject(err);\r\n                })\r\n        });\r\n        return promise;\r\n    }\r\n}\r\nexport default TestModel;"]}