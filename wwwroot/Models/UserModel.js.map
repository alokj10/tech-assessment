{"version":3,"sources":["../../src/Models/UserModel.js"],"names":["UserModel","entityName","entities","GetAll","userEntity","queryConfig","VIEW_USERS","db","GetUser","userId","Promise","resolve","reject","findOne","then","res","GetUserByEmail","emailId","sql","queries","getUserByEmailIdQuery","executeQuery","Add","entity","insert","insertId","catch","err","Update","user_meta","modifiedOn","Date","toLocaleDateString","update","id","Delete","delete","VerifyUser","userIv","userContent","console","log","SendVerificationEmail","userDetail","email","name","encryptedObject","EmailConfig","verificationLink","getVerificationLink","emailInfo","to","subject","user_name","verification_link","notificationType","emailHelper","EmailHelper","SendEmail"],"mappings":"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","file":"UserModel.js","sourcesContent":["// import db from './db';\r\nimport db from '../db/mysqldb';\r\nimport users from '../users';\r\nimport queries from '../db/queries';\r\n\r\nimport { GetQueryConfig, \r\n    HandlePromise } from '../commons/RoleDefinitions';\r\nimport { VIEW_USERS } from '../commons/RoleBasedQueries/UserQueries';\r\nimport { getSiteUrl, encrypt, decrypt } from '../utils/general';\r\nimport EmailHelper from '../commons/EmailHelper';\r\nimport { EmailConfig } from '../commons/ServerConfig';\r\n\r\nclass UserModel {\r\n    entityName = 'users';\r\n    entities = {};\r\n    \r\n    \r\n    GetAll = (userEntity) => {\r\n        let queryConfig = GetQueryConfig(VIEW_USERS);\r\n        return HandlePromise(db, queryConfig, userEntity);\r\n    }\r\n\r\n    GetUser = (userId) => {\r\n        return new Promise((resolve, reject) => {\r\n            db.findOne(this.entityName, userId).then((res) => {\r\n                resolve(res);\r\n            });\r\n        })\r\n    }\r\n\r\n    GetUserByEmail = (emailId) => {\r\n        return new Promise((resolve, reject) => {\r\n            let sql = queries.getUserByEmailIdQuery(emailId);\r\n            db.executeQuery(sql).then((res) => {\r\n                resolve(res);\r\n            });\r\n        })\r\n    }\r\n\r\n    Add = (entity) => {\r\n        return new Promise((resolve, reject) => {\r\n            db.insert(this.entityName, entity).then((insertId) => {\r\n                resolve(insertId);\r\n            })\r\n            .catch((err) => {\r\n                reject(err);\r\n            })\r\n        });\r\n    }\r\n\r\n    Update = (entity) => {\r\n        entity.user_meta.modifiedOn = (new Date()).toLocaleDateString();\r\n        return new Promise((resolve, reject) => {\r\n            db.update(this.entityName, entity.user_meta, entity.id).then((res) => {\r\n                resolve(res);\r\n            });\r\n        });\r\n    }\r\n\r\n    Delete = (entity) => {\r\n        return new Promise((resolve, reject) => {\r\n            db.delete(this.entityName, entity.id);\r\n            resolve(entity.user_meta);\r\n        });\r\n    }\r\n\r\n    VerifyUser = async (userIv, userContent) => {\r\n        let userId = decrypt(userIv, userContent);\r\n        console.log('decryption result: ', userId);\r\n        if(userId) {\r\n            let userEntity = await this.GetUser(userId);\r\n            return userEntity;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    SendVerificationEmail = async (userId) => {\r\n        let userEntity = await this.GetUser(userId);\r\n        let userDetail = {\r\n            userId: userId, \r\n            email: userEntity.user_meta.emailId,\r\n            name: userEntity.user_meta.name\r\n        }\r\n        let encryptedObject = encrypt(`${userDetail.userId}`); \r\n        console.log('encryptedObject in model: ', encryptedObject);\r\n        let verificationLink = EmailConfig.getVerificationLink(await getSiteUrl(), encryptedObject);\r\n        console.log('verification link: ', verificationLink);\r\n        let emailInfo = {\r\n            to: userDetail.email,\r\n            subject: `Welcome - Verify user email`,\r\n            user_name: userEntity.user_meta.name,\r\n            verification_link: verificationLink,\r\n            notificationType: 'verify_user_email'\r\n        };\r\n        let emailHelper = new EmailHelper();\r\n        emailHelper.SendEmail(emailInfo);\r\n    }\r\n\r\n    /*initializeCollection = () => {\r\n        var promise = new Promise((resolve, reject) => {\r\n            db.getCollection(this.entityName)\r\n                .then((res) => {\r\n                    this.entities = res;\r\n                    resolve(this.entities);\r\n                }).catch((err) => {\r\n                    console.log('error occurred: ', err);\r\n                    reject(err);\r\n                })\r\n        });\r\n        return promise;\r\n    }*/\r\n}\r\nexport default UserModel;"]}