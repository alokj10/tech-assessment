{"version":3,"sources":["../../src/Models/McqModel.js"],"names":["McqModel","entityName","entities","entityModel","dbObject","model","id","mcq_meta","author","addedBy","category","choices","correctAnswer","description","minimumExperience","maximumExperience","question","score","skill","GetAll","userEntity","queryConfig","VIEW_MCQS","db","GetMcqsBySkill","VIEW_MCQS_BY_SKILL","BulkAddMcq","jsonData","Promise","resolve","reject","mcqs","length","map","item","index","Add","then","res","console","log","catch","error","entity","correctOptions","indexOf","choice","chIndex","isCorrect","key","insert","insertId","err","GetMcqsByIds","mcqIds","getByIds","Update","update","DeleteByIds","deleteByIds","Delete","delete","initializeCollection","promise","getCollection"],"mappings":"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","file":"McqModel.js","sourcesContent":["// import db from './db';\r\nimport db from '../db/mysqldb';\r\nimport users from '../users';\r\n\r\nimport { GetQueryConfig, \r\n    HandlePromise, \r\n    HandlePromiseWithParams} from '../commons/RoleDefinitions';\r\nimport { VIEW_MCQS, VIEW_MCQS_BY_SKILL } from '../commons/RoleBasedQueries/McqQueries';\r\n\r\n\r\nclass McqModel {\r\n    entityName = 'mcq';\r\n    entities = {};\r\n    entityModel = (dbObject) => {\r\n        let model = {\r\n            // id: dbObject['$loki'],\r\n            id: dbObject.id,\r\n            mcq_meta: {\r\n                author: dbObject.mcq_meta.addedBy,\r\n                category: dbObject.mcq_meta.category,\r\n                choices: dbObject.mcq_meta.choices,\r\n                correctAnswer: dbObject.mcq_meta.correctAnswer,\r\n                description: dbObject.mcq_meta.description,\r\n                minimumExperience: dbObject.mcq_meta.minimumExperience,\r\n                maximumExperience: dbObject.mcq_meta.maximumExperience,\r\n                question: dbObject.mcq_meta.question,\r\n                score: dbObject.mcq_meta.score,\r\n                skill: dbObject.mcq_meta.skill\r\n            }\r\n        };\r\n        // dbObject.mcq_meta.choices.map((choice, index) => {\r\n        //     model.mcq_meta.choices.push(choice);\r\n        // });\r\n        return model;\r\n    };\r\n\r\n    constructor() {\r\n      //this.initializeCollection();\r\n    }\r\n\r\n    GetAll = (userEntity) => {\r\n        let queryConfig = GetQueryConfig(VIEW_MCQS);\r\n        return HandlePromise(db, queryConfig, userEntity);\r\n    \r\n        /*return new Promise((resolve, reject) => {\r\n            \r\n            this.initializeCollection().then((res) => {\r\n                if(userEntity && userEntity.role === users.UserRoles.admin) {\r\n                    console.log(this.entities.data.length);\r\n                    let entityModelCollection = [];\r\n                    console.log('entities',this.entities);\r\n                    this.entities.data.map((mcq, index) => {\r\n                        let entityModel = this.entityModel(mcq);\r\n                        entityModelCollection.push(entityModel);\r\n                    });\r\n                    resolve(entityModelCollection);\r\n                }\r\n                else {\r\n                    resolve(this.GetMcqsByUser(userEntity));\r\n                }\r\n            });\r\n        })*/\r\n    }\r\n\r\n    GetMcqsBySkill = (userEntity, skill) => {\r\n        let queryConfig = GetQueryConfig(VIEW_MCQS_BY_SKILL);\r\n        return HandlePromiseWithParams(db, queryConfig, { userEntity: userEntity, skill: skill });\r\n    }\r\n    /*GetMcqsByUser = (userEntity) => {\r\n        if(this.entities.data && this.entities.data.length > 0 && userEntity) {\r\n            let filteredMcqs = this.entities.data.filter((item, index) => {\r\n                return item.mcq_meta.addedBy = userEntity.emailId;\r\n            });\r\n            console.log(filteredMcqs.length);\r\n            let entityModelCollection = [];\r\n            filteredMcqs.map((mcq, index) => {\r\n                let entityModel = this.entityModel(mcq);\r\n                entityModelCollection.push(entityModel);\r\n            });\r\n            return entityModelCollection;\r\n        }\r\n        return [];\r\n    }*/\r\n\r\n    BulkAddMcq = (jsonData) => {\r\n        return new Promise((resolve, reject) => {\r\n            let mcqs = jsonData.mcqs;\r\n            if(mcqs && mcqs.length > 0) {\r\n                mcqs.map((item, index) => {\r\n                    item.mcq_meta.addedBy = jsonData.addedBy;\r\n                    this.Add(item.mcq_meta)\r\n                      .then((res) => {\r\n                          console.log('mcq added');\r\n                      })\r\n                      .catch((error) => {\r\n                          console.log('mcq add failed: ' + error);\r\n                      });\r\n                })\r\n            } \r\n            resolve(true);\r\n        })\r\n    }\r\n\r\n    Add = (entity) => {\r\n      return new Promise((resolve, reject) => {\r\n          console.log('mcq insert called');\r\n          let correctOptions = ['A','B','C','D','E','F'];\r\n          if(entity.correctAnswer && correctOptions.indexOf(entity.correctAnswer) > -1) {\r\n                if(entity.choices && entity.choices.length > 0) {\r\n                    entity.choices.map((choice, chIndex) => {\r\n                        if(chIndex === correctOptions.indexOf(entity.correctAnswer)) {\r\n                            choice.isCorrect = true;              \r\n                        }\r\n                        else {\r\n                            choice.isCorrect = false;\r\n                        }\r\n                        if(!choice.key) {\r\n                            choice.key = correctOptions[chIndex];\r\n                        }\r\n                    })\r\n                }\r\n          }\r\n          db.insert(this.entityName, entity)\r\n                .then((insertId) => {\r\n                    resolve(insertId);\r\n                })\r\n                .catch((err) => {\r\n                    reject(err);\r\n                })\r\n\r\n      });\r\n    }\r\n\r\n    GetMcqsByIds = (mcqIds) => {\r\n        return new Promise((resolve, reject) => {\r\n            db.getByIds(this.entityName, mcqIds).then((mcqs) => {\r\n                resolve(mcqs);\r\n            }).catch((err) => {\r\n                reject(err);\r\n            })\r\n        })\r\n    }\r\n\r\n    Update = (entity) => {\r\n      return new Promise((resolve, reject) => {\r\n          // let mcqs = this.initializeCollection();\r\n            db.update(this.entityName, entity.mcq_meta, entity.id).then((res) => {\r\n                resolve(res);\r\n            });\r\n          /*\r\n          let mcqToUpdate = this.entities.find({ '$loki': entity.$loki });\r\n          if(mcqToUpdate && mcqToUpdate.length > 0) {\r\n              mcqToUpdate[0].title = entity.title;\r\n              mcqToUpdate[0].description = entity.description;\r\n              if(entity.user) {\r\n                  mcqToUpdate[0].updatedBy = entity.emailId;\r\n              }\r\n              this.entities.update(mcqToUpdate[0]);\r\n              db.saveDatabase(() => {\r\n                this.EmailSnapshot('CategoryAdd');\r\n            });\r\n    \r\n              resolve(true);\r\n          }\r\n          else {\r\n              console.log('nothing to update');\r\n              reject(\"nothing to update\");\r\n          }*/\r\n      })\r\n    }\r\n\r\n    DeleteByIds = (mcqIds) => {\r\n        return new Promise((resolve, reject) => {\r\n            db.deleteByIds(this.entityName, mcqIds).then((res) => {\r\n                resolve(res);\r\n            }).catch((err) => {\r\n                reject(err);\r\n            })\r\n        })\r\n    }\r\n\r\n    Delete = (entity) => {\r\n      return new Promise((resolve, reject) => {\r\n          db.delete(this.entityName, entity.id)\r\n                    .then((res) => {\r\n                        resolve(entity.mcq_meta);\r\n                    })\r\n                    .catch((err) => {\r\n                        reject(err);\r\n                    })\r\n        //   let mcqToDelete = this.entities.chain().find({ '$loki': entity.$loki });\r\n        //   if(mcqToDelete) {\r\n        //       mcqToDelete.remove();\r\n        //         db.saveDatabase(() => {\r\n        //             this.EmailSnapshot('CategoryAdd');\r\n        //         });\r\n    \r\n        //       resolve(true);\r\n        //   }\r\n        //   else {\r\n        //       console.log('nothing to delete');\r\n        //       reject(\"nothing to delete\");\r\n        //   }\r\n      })\r\n    }\r\n\r\n    // initializeCollection = () => {\r\n    //   this.entities = db.getCollection('mcqs');\r\n    //   if(!this.entities) {\r\n    //       this.entities = db.addCollection('mcqs');\r\n    //   }\r\n    //   console.log('mcq entity initialized', this.entities.data.length);\r\n    // }\r\n    initializeCollection = () => {\r\n        var promise = new Promise((resolve, reject) => {\r\n            db.getCollection(this.entityName)\r\n                .then((res) => {\r\n                    this.entities = res;\r\n                    resolve(this.entities);\r\n                }).catch((err) => {\r\n                    console.log('error occurred: ', err);\r\n                    reject(err);\r\n                })\r\n        });\r\n        return promise;\r\n    }\r\n}\r\nexport default McqModel;\r\n"]}